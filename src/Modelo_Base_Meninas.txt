===============================
MATRIX ‚Äî MODELO DE MENINA (BOT)
===============================

üöÄ Contexto
-----------
Cada "menina" √© um bot de vendas (persona pr√≥pria) conectado √† Matrix.  
Estrutura modular: prompts, FSM, ferramentas (tools), telemetria, mem√≥ria.  
Execu√ß√£o em container Railway (1 inst√¢ncia = 1 n√∫mero de WhatsApp).  

--------------------------------
üì¶ Estrutura de Pastas (src/)
--------------------------------
src/
  index.js          # server Express + rotas (health, webhook, QR, etc.)
  wpp.js            # adapter WhatsApp (Baileys + typing + reconex√£o)
  bot.js            # FSM/intents + guardrails
  model.js          # wrapper LLM (OpenAI)
  memory.js         # mem√≥ria curta (TTL ou Redis no futuro)
  telemetry.js      # log de eventos
  middlewares/
    rateLimit.js    # limitador de flood
  prompts/
    base.js         # persona + style rules (JSON base)
    product.js      # dados de produto (price, claims, checkout)
  flows/
    greet.js        # abertura
    qualify.js      # qualifica√ß√£o
    offer.js        # oferta
    close.js        # fechamento
    postsale.js     # p√≥s-venda
  utils/
    polish.js       # varia√ß√£o de frases + anti-loop
    smartSend.js    # envia foto do produto + texto

--------------------------------
‚öôÔ∏è Vari√°veis de Ambiente (.env)
--------------------------------
OPENAI_API_KEY=xxxx
MODEL_NAME=gpt-4o
PRICE_ORIGINAL=197
PRICE_TARGET=170
CHECKOUT_LINK=https://entrega.logzz.com.br/pay/xxxxx
COUPON_CODE=TOP-AGO2025-PRODUTO-150
WPP_AUTH_DIR=/app/baileys-auth
MEMORY_TTL_DAYS=7
PORT=8080

# (opcional tuning)
TYPING_MS_PER_CHAR=35
TYPING_MIN_MS=800
TYPING_MAX_MS=5000

--------------------------------
üß† Persona Base (exemplo Cl√°udia)
--------------------------------
display_name: "Cl√°udia"
role: "Vendedora oficial da TopOfertas Express"
tone: emp√°tica, confiante, consultiva
style: respostas curtas (1‚Äì2 frases, m√°x. 3 linhas), at√© 2 emojis
guardrails:
  - nunca revelar ser IA
  - link apenas no close com inten√ß√£o clara
  - pagamento sempre COD
  - se receber m√≠dia: pedir resumo em texto

--------------------------------
üîó Fluxo FSM (padr√£o)
--------------------------------
1) greet      ‚Üí abertura + pergunta leve
2) qualify    ‚Üí tipo de cabelo/dor
3) offer      ‚Üí benef√≠cios + pre√ßo + prazo + COD (sem link)
4) close      ‚Üí s√≥ envia link se inten√ß√£o clara
5) postsale   ‚Üí valida comprovante + libera cupom

Extras:
- objections (pre√ßo, medo, confian√ßa)
- remarketing (n√£o usar em chat ativo)
- segunda_compra (desconto fidelidade)

--------------------------------
üõ†Ô∏è Tools (padr√£o)
--------------------------------
getPrice(productId)
getDeliveryETA(cep)
checkStock(productId)
createCheckout(productId, payment)
applyCoupon(code)
saveLead(userId, nome, intent)
logTelemetry(event)

--------------------------------
üìä Telemetria
--------------------------------
Evento JSON:
{
  ts, userId, stage, intent,
  msg_in, msg_out,
  took_ms, next_action,
  conversion?, loss_reason?
}

--------------------------------
üß™ Roteiro Testes
--------------------------------
- /health responde {ok:true}
- /wpp/qr mostra QRCode e conecta
- greet pede nome (1 pergunta s√≥)
- qualify mapeia tipo de cabelo sem repetir
- offer mostra pre√ßo, prazo, COD (sem link)
- close manda link s√≥ se lead quiser comprar
- postsale reconhece comprovante + libera cupom
- telemetria registra eventos

--------------------------------
üöÄ Deploy no Railway
--------------------------------
1. Conectar repo
2. Variables (.env) ‚Üí preencher
3. Volumes ‚Üí mount path /app/baileys-auth
4. Deploy autom√°tico main
5. Testar: 
   GET  /health
   GET  /wpp/qr (parear n√∫mero)
   POST /webhook {"userId":"c001","text":"Oi, Cl√°udia!"}

--------------------------------
üß¨ Clonar Nova Menina
--------------------------------
1) Copiar pasta base (ex.: /claudia ‚Üí /livia)
2) Ajustar persona + prompts/base.js
3) Atualizar product.js (nome, pre√ßo, claims, foto)
4) Trocar vari√°veis .env (CHECKOUT_LINK, PRICE_TARGET, etc.)
5) Deploy nova inst√¢ncia Railway (novo n√∫mero)
6) Parear QR em /wpp/qr
